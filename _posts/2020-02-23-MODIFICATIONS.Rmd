---
title: A few steps in data cleaning
output:
  md_document:
    variant: markdown_github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, error = FALSE)

```

If you have ever looked at messy data you probably know already that it could be very frustrating to try to clean it if you do not have the right tools at your disposal. Some people even try to do it **gasps** manually. 

Here I would like to introduce two very useful functions in the `tidyr` package used in `R`. These two functions are `tidyr::gather()` and `tidyr::spread`. The `gather()` function will help you convert a wide dataset to a long one and `spread()` does the opposite. They are both very useful and depending on your purpose you may use one or the other, or both!

### The Dataset
Consider the following dataset, which is presented as a _time series_ monitoring average sales at a mid-size retail store (measured in $1,000s) collected monthly for 12 months, grouped based on three categories; sales from the _produce_ section, sales from the _meat_ section, and sales from the _deli_ section.


```{r include= FALSE}
sales <- read.csv("sales.csv", stringsAsFactors = FALSE)
```
```{r echo=FALSE}
sales
```

You may want to _clean_ in different ways. However, two ideas may immediately jump at you as the most obvious ways you may want to change (or clean) this dataset. You may either want to make it longer by combining (or _gathering_) the values from different months into one variable (`month` maybe), or you may want to make it wider by _spreading_ the contents of the `category` variable into two new variables. Let's start with the first idea.

### Wide to Long
You already have an idea in mind about what your new variable should look like. Let's call it `Month`. This variable would contain the name of the month, for which we have collected sales volumes. We already know there will be some repetition here since we are looking at sales numbers for three different department. 

```{r echo=TRUE}
sales2 <- tidyr::gather(sales, "Month", "Sales", -Category)
```
You might have noticed that we excluded the variable Category, using `-Category`. This is because we did not want Category to be gathered (combined) along with the months. Also notice, since the content of the variables in the original dataset was sales volumes, after combining those variables into a new variable (Month) we should also house the sales volumes somewhere. That is why we are including `"Sales"` in the code, indicating that the content of the original variables should now be included under this new variable `Sales`.

Let's look at the new dataset `Sales2` below.
```{r echo=FALSE}
sales2
```

As you can see here the new variable `Month` now hosts the name of the months and the new variable `Sales` has the sales volumes corresponding to each month and category. As the result of this code, the dataset became a little longer.

Notice how the new variable `Month` has the content sorted alphabetically. We will change this later.

Also notice that each month name is repeated three times in the Month variable to account for sales volumes for each department. However, you may prefer to have a _clean_ variable `Month`, where each month name is mentioned only once. In order to achieve this, you should break the category variable into three new categories so that for each observation _Month_ you will see the sales volume for `meat`, `produce` and `deli` under three different variables. Obviously you will not need the `Sales` variable after that. Next we will work with another function to achieve this.  

### Long to Wide
Assume you want to make the dataset a little wider by breaking the first variable into two new variables; `Produce` and `Meat`. Also, for the content of the two new variables, we will be using the content of variable `Sales`. Therefore, `Sales` will also be obsolete and should be eliminated. 
We are going to use the function `spread()` from the `tidyr` package. Here is the code to do that.

```{r echo= TRUE}
sales3 <- tidyr::spread(sales2, "Category", "Sales")
sales3
```

Notice how sales volumes are now stated separately under the three new variables `Produce`, `Meat` and `deli`. Both variables `Category` and `Sales` have been dropped. Now each month name is a separate observation for this dataset. As a result of this, the dataset became a little wider.

Since each month name is an observation, and this was a time-series to begin with, we would like to sort the dataset based on the month name so that it starts with January and ends with December. Also, let's re-order the columns so that `produce` is first, followed by `meat` and `deli`. Below see the sorted dataset.

```{r include = FALSE}
sales4 <- cbind(Index = match(sales3$Month, month.name), sales3)
sales4sorted <- sales4[order(sales4$Index),]
sales4sorted$Index <- NULL
row.names(sales4sorted) <- c(1:12)
cal_order <- c("Month", "produce", "meat", "deli")
sales5 <- sales4sorted[ ,cal_order]
```
```{r echo= FALSE}
sales5
```

There is much more to cleaning data and the `tidyr` package in particular. For an overview check out this [link](https://www.rdocumentation.org/packages/tidyr/versions/0.8.3)!

Happy Sunday everyone :)


